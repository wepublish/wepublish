fragment FullCommentRatingSystemAnswer on CommentRatingSystemAnswer {
  id
  ratingSystemId
  answer
  type
}

fragment FullCommentRating on CommentRating {
  id
  commentId
  userId
  createdAt
  disabled
  value

  answer {
    ...FullCommentRatingSystemAnswer
  }
}

fragment FullCalculatedRating on CalculatedRating {
  count
  total
  mean

  answer {
    ...FullCommentRatingSystemAnswer
  }
}

fragment FullOverriddenRating on OverriddenRating {
  answerId
  value
}

fragment CommentWithoutNesting on Comment {
  id
  itemID
  itemType
  parentID

  createdAt
  modifiedAt

  title
  lead
  text
  authorType
  rejectionReason
  state
  url

  tags {
    ...FullTag
  }

  user {
    ...FullUser
  }

  source
  guestUsername
  guestUserImage {
    ...FullImage
  }

  calculatedRatings {
    ...FullCalculatedRating
  }

  overriddenRatings {
    ...FullOverriddenRating
  }

  featured

  userRatings {
    ...FullCommentRating
  }
}

fragment FullComment on Comment {
  ...CommentWithoutNesting

  children {
    ...CommentWithoutNesting

    children {
      ...CommentWithoutNesting

      children {
        ...CommentWithoutNesting

        children {
          ...CommentWithoutNesting

          children {
            ...CommentWithoutNesting
          }
        }
      }
    }
  }
}

fragment FullRatingSystemAnswer on CommentRatingSystemAnswer {
  id
  type
  answer
  ratingSystemId
}

fragment FullRatingSystem on CommentRatingSystem {
  id
  name

  answers {
    ...FullRatingSystemAnswer
  }
}

query CommentList($itemId: String!, $order: SortOrder, $sort: CommentSort) {
  commentsForItem(
    itemId: $itemId
    itemType: article
    order: $order
    sort: $sort
  ) {
    ...FullComment
  }

  ratingSystem {
    ...FullRatingSystem
  }
}

mutation AddComment(
  $itemID: String!
  $parentID: String
  $guestUsername: String
  $title: String
  $text: RichText!
) {
  addUserComment(
    itemID: $itemID
    itemType: article
    parentID: $parentID
    guestUsername: $guestUsername
    title: $title
    text: $text
  ) {
    ...FullComment
  }
}

mutation EditComment(
  $id: String!
  $title: String
  $lead: String
  $text: RichText!
) {
  updateUserComment(id: $id, title: $title, lead: $lead, text: $text) {
    ...FullComment
  }
}

mutation RateComment($answerId: String!, $commentId: String!, $value: Int!) {
  rateComment(answerId: $answerId, commentId: $commentId, value: $value) {
    ...FullComment
  }
}
